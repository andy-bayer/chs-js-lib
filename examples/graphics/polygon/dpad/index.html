<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
        <link rel="stylesheet" href="/chs-js-lib/assets/style.css" />
        <script type="text/javascript" src="/chs-js-lib/assets/main.js"></script>
        <title>Polygon - D-Pad</title>
    </head>
    <body>
        <header>
            <h1>Polygon - D-Pad</h1>
            <nav>
                <a href="/chs-js-lib/">Home</a>
                <a href="/chs-js-lib/examples">Examples</a>
                <a href="/chs-js-lib/docs">Documentation</a>
            </nav>
        </header>

        <main>
            <div style="display: flex">
                <canvas id="game" width="480" height="200"></canvas>
            </div>
            <script src="/chs-js-lib/assets/chs.iife.js"></script>
            <script id="code" type="module">
                const shapes = [];
                const position = { x: 0, y: 0 };
                const points = [
                    { x: 0, y: 0 },
                    { x: 15, y: 15 },
                    { x: 50, y: 15 },
                    { x: 50, y: -15 },
                    { x: 15, y: -15 },
                ];
                const directions = ['right', 'down', 'left', 'up'];
                for (var i = 0; i < 4; i++) {
                    const rotation = (i * Math.PI) / 2;
                    const button = new Polygon();
                    points.forEach(function (point) {
                        const x =
                            point.x * Math.cos(rotation) -
                            point.y * Math.sin(rotation) +
                            getWidth() / 2;
                        const y =
                            point.x * Math.sin(rotation) +
                            point.y * Math.cos(rotation) +
                            getHeight() / 2;
                        button.addPoint(x, y);
                    });
                    button.setColor(Color.GRAY);
                    button.direction = directions[i];
                    shapes.push(button);
                    add(button);
                }

                const press = function (direction) {
                    shapes.forEach(shape => {
                        if (shape.direction === direction) {
                            shape.setColor('#a8a8a8');
                            shape.pressed = true;
                            needsUpdate = true;
                        }
                    });
                };

                const unpress = function (direction) {
                    shapes.forEach(shape => {
                        if (shape.direction === direction) {
                            if (shape.pressed) {
                                shape.setColor(Color.GRAY);
                                shape.pressed = false;
                            }
                        }
                    });
                };

                mouseDownMethod(e => {
                    let x;
                    let y;
                    if (e.touches) {
                        x = e.touches[0].clientX;
                        y = e.touches[0].clientY;
                    } else {
                        x = e.getX();
                        y = e.getY();
                    }
                    shapes.forEach(shape => {
                        if (shape.containsPoint(x, y)) {
                            press(shape.direction);
                        }
                    });
                });
                mouseUpMethod(e => {
                    shapes.forEach(shape => {
                        unpress(shape.direction);
                    });
                });
            </script>
            <p>
                A directional input, which shows containsPoint for complex polygons. Click or touch
                the four directions of the d-pad.
            </p>
        </main>
    </body>
</html>
